<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Masjid Mekarindah</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #1B5E20;
            --primary-dark: #0D3D12;
            --primary-light: #4CAF50;
            --gold: #D4AF37;
            --white: #ffffff;
            --light: #f5f5f5;
            --gray: #666666;
            --dark: #333333;
            --danger: #e53935;
            --warning: #ff9800;
            --success: #4CAF50;
            --sidebar-width: 260px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: var(--light); min-height: 100vh; }
        
        /* LOGIN */
        .login-screen {
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); padding: 20px;
        }
        .login-box {
            background: var(--white); padding: 40px; border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 400px; text-align: center;
        }
        .login-box .logo { font-size: 4rem; color: var(--primary); margin-bottom: 20px; }
        .login-box h1 { color: var(--primary); margin-bottom: 10px; font-size: 1.8rem; }
        .login-box p { color: var(--gray); margin-bottom: 30px; }
        .login-box .form-group { margin-bottom: 20px; text-align: left; }
        .login-box label { display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500; }
        .login-box input {
            width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px;
            font-size: 1rem; transition: border-color 0.3s;
        }
        .login-box input:focus { outline: none; border-color: var(--primary); }
        .login-box .btn-login {
            width: 100%; padding: 15px; background: var(--primary); color: var(--white);
            border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer;
        }
        .login-box .btn-login:hover { background: var(--primary-dark); }
        .login-error {
            background: #ffebee; color: var(--danger); padding: 12px; border-radius: 8px;
            margin-bottom: 20px; display: none; align-items: center; gap: 10px;
        }
        
        /* ADMIN LAYOUT */
        .admin-container { display: none; min-height: 100vh; }
        .admin-container.active { display: flex; }
        
        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width); background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            min-height: 100vh; position: fixed; left: 0; top: 0; z-index: 1000;
            display: flex; flex-direction: column; transition: transform 0.3s;
        }
        .sidebar-header { padding: 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.1); text-align: center; }
        .sidebar-header .logo { color: var(--gold); font-size: 2.5rem; margin-bottom: 10px; }
        .sidebar-header h2 { color: var(--white); font-size: 1.1rem; font-weight: 600; }
        .sidebar-header p { color: rgba(255,255,255,0.7); font-size: 0.8rem; }
        .sidebar-menu { flex: 1; padding: 20px 0; overflow-y: auto; max-height: calc(100vh - 180px); }
        .sidebar-menu::-webkit-scrollbar { width: 6px; }
        .sidebar-menu::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }
        .menu-item {
            display: flex; align-items: center; padding: 15px 25px; color: rgba(255,255,255,0.8);
            text-decoration: none; transition: all 0.3s; cursor: pointer; border: none;
            background: none; width: 100%; text-align: left; font-size: 0.95rem; font-family: inherit;
        }
        .menu-item:hover { background: rgba(255,255,255,0.1); color: var(--white); }
        .menu-item.active { background: rgba(255,255,255,0.15); color: var(--gold); border-left: 4px solid var(--gold); }
        .menu-item i { width: 25px; margin-right: 12px; font-size: 1.1rem; }
        .sidebar-footer { padding: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
        .btn-logout {
            display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%;
            padding: 12px; background: rgba(255,255,255,0.1); color: var(--white); border: none;
            border-radius: 10px; cursor: pointer; font-size: 0.95rem; font-family: inherit;
        }
        .btn-logout:hover { background: var(--danger); }
        
        /* MAIN CONTENT */
        .main-content { flex: 1; margin-left: var(--sidebar-width); min-height: 100vh; }
        .topbar {
            background: var(--white); padding: 20px 30px; display: flex; justify-content: space-between;
            align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100;
        }
        .topbar h1 { font-size: 1.5rem; color: var(--dark); display: flex; align-items: center; gap: 10px; }
        .topbar h1 i { color: var(--primary); }
        .btn-mobile-menu { display: none; background: none; border: none; font-size: 1.5rem; color: var(--primary); cursor: pointer; }
        .btn-view-site {
            display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: var(--primary);
            color: var(--white); text-decoration: none; border-radius: 8px; font-size: 0.9rem;
        }
        .btn-view-site:hover { background: var(--primary-dark); }
        .page-content { padding: 30px; }
        .page { display: none; }
        .page.active { display: block; }
        
        /* CARDS */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--white); padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); display: flex; align-items: center; gap: 20px; }
        .stat-card .icon { width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--white); }
        .stat-card .icon.green { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
        .stat-card .icon.gold { background: linear-gradient(135deg, var(--gold), #F4D03F); }
        .stat-card .icon.blue { background: linear-gradient(135deg, #1976D2, #42A5F5); }
        .stat-card .icon.purple { background: linear-gradient(135deg, #7B1FA2, #BA68C8); }
        .stat-card .info h3 { font-size: 1.8rem; color: var(--dark); margin-bottom: 5px; }
        .stat-card .info p { color: var(--gray); font-size: 0.9rem; }
        .card { background: var(--white); border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 25px; overflow: hidden; }
        .card-header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: var(--white); padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        .card-header h3 i { color: var(--gold); }
        .card-body { padding: 25px; }
        
        /* FORMS */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: var(--dark); font-weight: 500; }
        .form-group label .required { color: var(--danger); }
        .form-control { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 0.95rem; font-family: inherit; }
        .form-control:focus { outline: none; border-color: var(--primary); }
        textarea.form-control { min-height: 120px; resize: vertical; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-hint { font-size: 0.8rem; color: var(--gray); margin-top: 5px; }
        select.form-control { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 15px center; padding-right: 40px; }
        
        /* BUTTONS */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 25px; border: none; border-radius: 10px; font-size: 0.95rem; font-weight: 500; cursor: pointer; font-family: inherit; }
        .btn-primary { background: var(--primary); color: var(--white); }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-success { background: var(--success); color: var(--white); }
        .btn-success:hover { background: #388E3C; }
        .btn-danger { background: var(--danger); color: var(--white); }
        .btn-danger:hover { background: #c62828; }
        .btn-warning { background: var(--warning); color: var(--white); }
        .btn-secondary { background: var(--gray); color: var(--white); }
        .btn-sm { padding: 8px 15px; font-size: 0.85rem; }
        .btn-icon { width: 38px; height: 38px; padding: 0; border-radius: 8px; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        
        /* TABLE */
        .table-responsive { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        table th, table td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        table th { background: var(--light); font-weight: 600; color: var(--dark); white-space: nowrap; }
        table tr:hover { background: #fafafa; }
        table img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
        .badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; }
        .badge-success { background: #e8f5e9; color: var(--success); }
        .badge-danger { background: #ffebee; color: var(--danger); }
        .badge-primary { background: #e3f2fd; color: #1976D2; }
        
        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: var(--white); border-radius: 15px; width: 100%; max-width: 600px; max-height: 90vh; overflow-y: auto; }
        .modal-header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: var(--white); padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 1.2rem; }
        .modal-close { background: none; border: none; color: var(--white); font-size: 1.5rem; cursor: pointer; }
        .modal-body { padding: 25px; }
        .modal-footer { padding: 15px 25px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
        
        /* SUMMARY */
        .summary-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .summary-item { background: var(--light); padding: 20px; border-radius: 10px; text-align: center; }
        .summary-item.pemasukan { border-left: 4px solid var(--success); }
        .summary-item.pengeluaran { border-left: 4px solid var(--danger); }
        .summary-item.saldo { border-left: 4px solid var(--primary); }
        .summary-item h4 { font-size: 1.5rem; margin-bottom: 5px; }
        .summary-item.pemasukan h4 { color: var(--success); }
        .summary-item.pengeluaran h4 { color: var(--danger); }
        .summary-item.saldo h4 { color: var(--primary); }
        .summary-item p { color: var(--gray); font-size: 0.85rem; }
        
        /* ALERT & LOADING */
        .alert { padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .alert-warning { background: #fff3e0; color: var(--warning); border: 1px solid var(--warning); }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); display: none; align-items: center; justify-content: center; z-index: 3000; flex-direction: column; gap: 15px; }
        .loading-overlay.active { display: flex; }
        .loading-overlay i { font-size: 3rem; color: var(--primary); animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: 30px; right: 30px; background: var(--dark); color: var(--white); padding: 15px 25px; border-radius: 10px; display: none; align-items: center; gap: 12px; z-index: 4000; }
        .toast.active { display: flex; }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--danger); }
        
        /* MISI LIST */
        .misi-list { border: 2px solid #e0e0e0; border-radius: 10px; padding: 15px; }
        .misi-item { display: flex; gap: 10px; margin-bottom: 10px; }
        .misi-item input { flex: 1; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px; font-family: inherit; }
        .misi-item input:focus { outline: none; border-color: var(--primary); }
        .btn-add-misi { width: 100%; padding: 10px; background: var(--light); border: 2px dashed #ccc; border-radius: 8px; cursor: pointer; color: var(--gray); font-size: 0.9rem; font-family: inherit; margin-top: 10px; }
        .btn-add-misi:hover { border-color: var(--primary); color: var(--primary); }
        
        /* KAJIAN */
        .kajian-edit-grid { display: grid; gap: 15px; }
        .kajian-day-card { background: var(--light); border-radius: 10px; overflow: hidden; }
        .kajian-day-header { background: var(--primary); color: var(--white); padding: 12px 15px; font-weight: 600; }
        .kajian-day-body { padding: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .kajian-day-body .form-group { margin-bottom: 0; }
        .kajian-day-body .form-control { padding: 10px; font-size: 0.9rem; }
        .kajian-day-body label { font-size: 0.85rem; margin-bottom: 5px; }
        
        /* GALERI */
        .galeri-preview { width: 80px; height: 60px; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .galeri-preview img { width: 100%; height: 100%; object-fit: cover; }
        .galeri-preview.youtube { background: #FF0000; color: white; }
        .galeri-preview.instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white; }
        .galeri-preview.tiktok { background: #000; color: white; }
        .platform-highlight { display: inline-flex; align-items: center; gap: 8px; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; }
        .platform-highlight.foto { background: #e3f2fd; color: #1976D2; }
        .platform-highlight.youtube { background: #ffebee; color: #FF0000; }
        .platform-highlight.instagram { background: linear-gradient(45deg, #fce4ec, #f3e5f5); color: #C13584; }
        .platform-highlight.tiktok { background: #f5f5f5; color: #000; }
        
        /* TOGGLE */
        .toggle-switch { position: relative; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: 0.3s; border-radius: 26px; }
        .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: 0.3s; border-radius: 50%; }
        .toggle-switch input:checked + .toggle-slider { background-color: var(--primary); }
        .toggle-switch input:checked + .toggle-slider:before { transform: translateX(24px); }
        
        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .btn-mobile-menu { display: block; }
            .topbar h1 { font-size: 1.2rem; }
            .page-content { padding: 15px; }
            .table-responsive table, .table-responsive thead, .table-responsive tbody, .table-responsive th, .table-responsive td, .table-responsive tr { display: block; }
            .table-responsive thead { display: none; }
            .table-responsive tr { background: var(--white); border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); padding: 15px; }
            .table-responsive td { padding: 10px 0; border: none; display: flex; justify-content: space-between; align-items: center; }
            .table-responsive td::before { content: attr(data-label); font-weight: 600; color: var(--dark); margin-right: 15px; }
            .table-responsive td:last-child { justify-content: flex-end; padding-top: 15px; border-top: 1px solid #eee; }
            .form-row { grid-template-columns: 1fr; }
            .btn-view-site span { display: none; }
        }
        .sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
        .sidebar-overlay.active { display: block; }
    </style>
</head>
<body>
    <!-- LOGIN SCREEN -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="logo"><i class="fas fa-mosque"></i></div>
            <h1>Admin Panel</h1>
            <p>Masjid Mekarindah</p>
            <div class="login-error" id="loginError"><i class="fas fa-exclamation-circle"></i><span>Username atau password salah!</span></div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="username" placeholder="Masukkan username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn-login"><i class="fas fa-sign-in-alt"></i> Masuk</button>
            </form>
        </div>
    </div>

    <!-- ADMIN CONTAINER -->
    <div class="admin-container" id="adminContainer">
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo"><i class="fas fa-mosque"></i></div>
                <h2>Masjid Mekarindah</h2>
                <p>Panel Admin</p>
            </div>
            <nav class="sidebar-menu">
                <button class="menu-item active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></button>
                <button class="menu-item" data-page="pengaturan"><i class="fas fa-cog"></i><span>Pengaturan</span></button>
                <button class="menu-item" data-page="jadwalSholat"><i class="fas fa-clock"></i><span>Jadwal Sholat</span></button>
                <button class="menu-item" data-page="pengurus"><i class="fas fa-users"></i><span>Pengurus</span></button>
                <button class="menu-item" data-page="kajian"><i class="fas fa-book-quran"></i><span>Jadwal Kajian</span></button>
                <button class="menu-item" data-page="keuangan"><i class="fas fa-wallet"></i><span>Keuangan</span></button>
                <button class="menu-item" data-page="zakat"><i class="fas fa-hand-holding-heart"></i><span>Zakat</span></button>
                <button class="menu-item" data-page="kisah"><i class="fas fa-book-open"></i><span>Kisah Inspiratif</span></button>
                <button class="menu-item" data-page="donasi"><i class="fas fa-donate"></i><span>Donasi</span></button>
                <button class="menu-item" data-page="galeri"><i class="fas fa-images"></i><span>Galeri</span></button>
                <button class="menu-item" data-page="pengumuman"><i class="fas fa-bullhorn"></i><span>Pengumuman</span></button>
            </nav>
            <div class="sidebar-footer">
                <button class="btn-logout" onclick="handleLogout()"><i class="fas fa-sign-out-alt"></i><span>Logout</span></button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <header class="topbar">
                <button class="btn-mobile-menu" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
                <h1 id="pageTitle"><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
                <div class="topbar-actions">
                    <a href="index.html" target="_blank" class="btn-view-site"><i class="fas fa-external-link-alt"></i><span>Lihat Website</span></a>
                </div>
            </header>

            <div class="page-content">
                <!-- PAGE DASHBOARD -->
                <div class="page active" id="page-dashboard">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="icon green"><i class="fas fa-wallet"></i></div><div class="info"><h3 id="statSaldoKas">Rp 0</h3><p>Saldo Kas Masjid</p></div></div>
                        <div class="stat-card"><div class="icon gold"><i class="fas fa-hand-holding-heart"></i></div><div class="info"><h3 id="statSaldoZakat">Rp 0</h3><p>Saldo Dana Zakat</p></div></div>
                        <div class="stat-card"><div class="icon blue"><i class="fas fa-users"></i></div><div class="info"><h3 id="statPengurus">0</h3><p>Total Pengurus</p></div></div>
                        <div class="stat-card"><div class="icon purple"><i class="fas fa-images"></i></div><div class="info"><h3 id="statGaleri">0</h3><p>Item Galeri</p></div></div>
                    </div>
                    <div class="card"><div class="card-header"><h3><i class="fas fa-info-circle"></i> Selamat Datang</h3></div><div class="card-body"><p>Selamat datang di Panel Admin Masjid Mekarindah.</p></div></div>
                    <div class="card"><div class="card-header"><h3><i class="fas fa-bullhorn"></i> Pengumuman Terbaru</h3></div><div class="card-body" id="dashboardPengumuman"><p style="color:var(--gray);">Belum ada pengumuman</p></div></div>
                </div>

                <!-- PAGE PENGATURAN -->
                <div class="page" id="page-pengaturan">
                    <form onsubmit="savePengaturan(event)">
                        <div class="card"><div class="card-header"><h3><i class="fas fa-mosque"></i> Informasi Masjid</h3></div><div class="card-body">
                            <div class="form-row">
                                <div class="form-group"><label>Nama Masjid</label><input type="text" class="form-control" id="setNamaMasjid" required></div>
                                <div class="form-group"><label>Foto Masjid (URL)</label><input type="url" class="form-control" id="setFotoMasjid"></div>
                            </div>
                            <div class="form-group"><label>Alamat</label><textarea class="form-control" id="setAlamat" rows="2"></textarea></div>
                            <div class="form-group"><label>Deskripsi</label><textarea class="form-control" id="setDeskripsi" rows="3"></textarea></div>
                        </div></div>
                        <div class="card"><div class="card-header"><h3><i class="fas fa-bullseye"></i> Visi & Misi</h3></div><div class="card-body">
                            <div class="form-group"><label>Visi</label><textarea class="form-control" id="setVisi" rows="2"></textarea></div>
                            <div class="form-group"><label>Misi</label><div class="misi-list" id="misiList"></div><button type="button" class="btn-add-misi" onclick="addMisiItem()"><i class="fas fa-plus"></i> Tambah Misi</button></div>
                        </div></div>
                        <div class="card"><div class="card-header"><h3><i class="fas fa-share-alt"></i> Sosial Media</h3></div><div class="card-body">
                            <div class="form-row">
                                <div class="form-group"><label>Facebook</label><input type="url" class="form-control" id="setFacebook"></div>
                                <div class="form-group"><label>Instagram</label><input type="url" class="form-control" id="setInstagram"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>YouTube</label><input type="url" class="form-control" id="setYoutube"></div>
                                <div class="form-group"><label>WhatsApp</label><input type="text" class="form-control" id="setWhatsapp" placeholder="6281234567890"></div>
                            </div>
                        </div></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan Pengaturan</button>
                    </form>
                </div>

                <!-- PAGE JADWAL SHOLAT -->
                <div class="page" id="page-jadwalSholat">
                    <div class="alert alert-warning"><i class="fas fa-info-circle"></i><span>Ini adalah backup jadwal jika API tidak tersedia.</span></div>
                    <form onsubmit="saveJadwalSholat(event)">
                        <div class="card"><div class="card-header"><h3><i class="fas fa-clock"></i> Jadwal Sholat Manual</h3></div><div class="card-body">
                            <div class="form-row">
                                <div class="form-group"><label>Subuh</label><input type="time" class="form-control" id="jadwalSubuh"></div>
                                <div class="form-group"><label>Dzuhur</label><input type="time" class="form-control" id="jadwalDzuhur"></div>
                                <div class="form-group"><label>Ashar</label><input type="time" class="form-control" id="jadwalAshar"></div>
                                <div class="form-group"><label>Maghrib</label><input type="time" class="form-control" id="jadwalMaghrib"></div>
                                <div class="form-group"><label>Isya</label><input type="time" class="form-control" id="jadwalIsya"></div>
                            </div>
                        </div></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan Jadwal</button>
                    </form>
                </div>

                <!-- PAGE PENGURUS -->
                <div class="page" id="page-pengurus">
                    <div class="card"><div class="card-header"><h3><i class="fas fa-users"></i> Daftar Pengurus</h3><button class="btn btn-success btn-sm" onclick="openModalPengurus()"><i class="fas fa-plus"></i> Tambah</button></div><div class="card-body"><div class="table-responsive"><table><thead><tr><th>Foto</th><th>Nama</th><th>Jabatan</th><th>Kategori</th><th>Aksi</th></tr></thead><tbody id="tbodyPengurus"></tbody></table></div></div></div>
                </div>

                <!-- PAGE KAJIAN -->
                <div class="page" id="page-kajian">
                    <form onsubmit="saveKajian(event)">
                        <div class="card"><div class="card-header"><h3><i class="fas fa-book-quran"></i> Jadwal Kajian Mingguan</h3></div><div class="card-body"><div class="kajian-edit-grid" id="kajianEditGrid"></div></div></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan Jadwal Kajian</button>
                    </form>
                </div>

                <!-- PAGE KEUANGAN -->
                <div class="page" id="page-keuangan">
                    <div class="summary-box">
                        <div class="summary-item pemasukan"><h4 id="keuanganPemasukan">Rp 0</h4><p>Total Pemasukan</p></div>
                        <div class="summary-item pengeluaran"><h4 id="keuanganPengeluaran">Rp 0</h4><p>Total Pengeluaran</p></div>
                        <div class="summary-item saldo"><h4 id="keuanganSaldo">Rp 0</h4><p>Saldo Akhir</p></div>
                    </div>
                    <div class="card"><div class="card-header"><h3><i class="fas fa-piggy-bank"></i> Saldo Awal</h3></div><div class="card-body"><div class="form-group" style="margin:0;"><label>Saldo Awal Kas</label><input type="number" class="form-control" id="keuanganSaldoAwal" onchange="updateSaldoAwalKeuangan()"></div></div></div>
                    <div class="card"><div class="card-header"><h3><i class="fas fa-exchange-alt"></i> Daftar Transaksi</h3><button class="btn btn-success btn-sm" onclick="openModalKeuangan()"><i class="fas fa-plus"></i> Tambah</button></div><div class="card-body"><div class="table-responsive"><table><thead><tr><th>Tanggal</th><th>Keterangan</th><th>Jenis</th><th>Jumlah</th><th>Aksi</th></tr></thead><tbody id="tbodyKeuangan"></tbody></table></div></div></div>
                </div>

                <!-- PAGE ZAKAT -->
                <div class="page" id="page-zakat">
                    <div class="summary-box">
                        <div class="summary-item pemasukan"><h4 id="zakatPemasukan">Rp 0</h4><p>Total Pemasukan</p></div>
                        <div class="summary-item pengeluaran"><h4 id="zakatPengeluaran">Rp 0</h4><p>Total Penyaluran</p></div>
                        <div class="summary-item saldo"><h4 id="zakatSaldo">Rp 0</h4><p>Saldo Akhir</p></div>
                    </div>
                    <div class="card"><div class="card-header"><h3><i class="fas fa-piggy-bank"></i> Saldo Awal</h3></div><div class="card-body"><div class="form-group" style="margin:0;"><label>Saldo Awal Zakat</label><input type="number" class="form-control" id="zakatSaldoAwal" onchange="updateSaldoAwalZakat()"></div></div></div>
                    <div class="card"><div class="card-header"><h3><i class="fas fa-exchange-alt"></i> Daftar Transaksi</h3><button class="btn btn-success btn-sm" onclick="openModalZakat()"><i class="fas fa-plus"></i> Tambah</button></div><div class="card-body"><div class="table-responsive"><table><thead><tr><th>Tanggal</th><th>Keterangan</th><th>Jenis</th><th>Jumlah</th><th>Aksi</th></tr></thead><tbody id="tbodyZakat"></tbody></table></div></div></div>
                </div>

                <!-- PAGE KISAH -->
                <div class="page" id="page-kisah">
                    <div class="card"><div class="card-header"><h3><i class="fas fa-book-open"></i> Daftar Kisah</h3><button class="btn btn-success btn-sm" onclick="openModalKisah()"><i class="fas fa-plus"></i> Tambah</button></div><div class="card-body"><div class="table-responsive"><table><thead><tr><th>Gambar</th><th>Judul</th><th>Isi</th><th>Aksi</th></tr></thead><tbody id="tbodyKisah"></tbody></table></div></div></div>
                </div>

                <!-- PAGE DONASI -->
                <div class="page" id="page-donasi">
                    <div class="card"><div class="card-header"><h3><i class="fas fa-donate"></i> Daftar Rekening</h3><button class="btn btn-success btn-sm" onclick="openModalDonasi()"><i class="fas fa-plus"></i> Tambah</button></div><div class="card-body"><div class="table-responsive"><table><thead><tr><th>Bank</th><th>No. Rekening</th><th>Atas Nama</th><th>Aksi</th></tr></thead><tbody id="tbodyDonasi"></tbody></table></div></div></div>
                </div>

                <!-- PAGE GALERI -->
                <div class="page" id="page-galeri">
                    <div class="alert alert-warning"><i class="fas fa-info-circle"></i><div>ðŸ“· Foto | ðŸŽ¬ YouTube | ðŸ“¸ Instagram | ðŸŽµ TikTok</div></div>
                    <div class="card"><div class="card-header"><h3><i class="fas fa-images"></i> Daftar Galeri</h3><button class="btn btn-success btn-sm" onclick="openModalGaleri()"><i class="fas fa-plus"></i> Tambah</button></div><div class="card-body"><div class="table-responsive"><table><thead><tr><th>Preview</th><th>Platform</th><th>Caption</th><th>Aksi</th></tr></thead><tbody id="tbodyGaleri"></tbody></table></div></div></div>
                </div>

                <!-- PAGE PENGUMUMAN -->
                <div class="page" id="page-pengumuman">
                    <div class="card"><div class="card-header"><h3><i class="fas fa-bullhorn"></i> Daftar Pengumuman</h3><button class="btn btn-success btn-sm" onclick="openModalPengumuman()"><i class="fas fa-plus"></i> Tambah</button></div><div class="card-body"><div class="table-responsive"><table><thead><tr><th>Tanggal</th><th>Judul</th><th>Isi</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="tbodyPengumuman"></tbody></table></div></div></div>
                </div>
            </div>
        </main>
    </div>
        <!-- MODALS -->
    
    <!-- Modal Pengurus -->
    <div class="modal" id="modalPengurus">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modalPengurusTitle">Tambah Pengurus</h3><button class="modal-close" onclick="closeModalPengurus()"><i class="fas fa-times"></i></button></div>
            <form onsubmit="savePengurus(event)">
                <div class="modal-body">
                    <input type="hidden" id="pengurusIndex" value="-1">
                    <div class="form-group"><label>Nama <span class="required">*</span></label><input type="text" class="form-control" id="pengurusNama" required></div>
                    <div class="form-group"><label>Jabatan <span class="required">*</span></label><input type="text" class="form-control" id="pengurusJabatan" required></div>
                    <div class="form-group"><label>Kategori <span class="required">*</span></label><select class="form-control" id="pengurusKategori" required><option value="">-- Pilih --</option><option value="Yayasan">Yayasan</option><option value="DKM">DKM</option><option value="Majlis Ta'lim">Majlis Ta'lim</option></select></div>
                    <div class="form-group"><label>Foto (URL)</label><input type="url" class="form-control" id="pengurusFoto"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModalPengurus()">Batal</button><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal Keuangan -->
    <div class="modal" id="modalKeuangan">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modalKeuanganTitle">Tambah Transaksi</h3><button class="modal-close" onclick="closeModalKeuangan()"><i class="fas fa-times"></i></button></div>
            <form onsubmit="saveKeuangan(event)">
                <div class="modal-body">
                    <input type="hidden" id="keuanganIndex" value="-1">
                    <div class="form-group"><label>Tanggal <span class="required">*</span></label><input type="date" class="form-control" id="keuanganTanggal" required></div>
                    <div class="form-group"><label>Jenis <span class="required">*</span></label><select class="form-control" id="keuanganJenis" required><option value="">-- Pilih --</option><option value="pemasukan">Pemasukan</option><option value="pengeluaran">Pengeluaran</option></select></div>
                    <div class="form-group"><label>Jumlah (Rp) <span class="required">*</span></label><input type="number" class="form-control" id="keuanganJumlah" required></div>
                    <div class="form-group"><label>Keterangan <span class="required">*</span></label><textarea class="form-control" id="keuanganKeterangan" rows="3" required></textarea></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModalKeuangan()">Batal</button><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal Zakat -->
    <div class="modal" id="modalZakat">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modalZakatTitle">Tambah Transaksi Zakat</h3><button class="modal-close" onclick="closeModalZakat()"><i class="fas fa-times"></i></button></div>
            <form onsubmit="saveZakat(event)">
                <div class="modal-body">
                    <input type="hidden" id="zakatIndex" value="-1">
                    <div class="form-group"><label>Tanggal <span class="required">*</span></label><input type="date" class="form-control" id="zakatTanggal" required></div>
                    <div class="form-group"><label>Jenis <span class="required">*</span></label><select class="form-control" id="zakatJenis" required><option value="">-- Pilih --</option><option value="pemasukan">Pemasukan</option><option value="pengeluaran">Penyaluran</option></select></div>
                    <div class="form-group"><label>Jumlah (Rp) <span class="required">*</span></label><input type="number" class="form-control" id="zakatJumlah" required></div>
                    <div class="form-group"><label>Keterangan <span class="required">*</span></label><textarea class="form-control" id="zakatKeterangan" rows="3" required></textarea></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModalZakat()">Batal</button><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal Kisah -->
    <div class="modal" id="modalKisah">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modalKisahTitle">Tambah Kisah</h3><button class="modal-close" onclick="closeModalKisah()"><i class="fas fa-times"></i></button></div>
            <form onsubmit="saveKisah(event)">
                <div class="modal-body">
                    <input type="hidden" id="kisahIndex" value="-1">
                    <div class="form-group"><label>Judul <span class="required">*</span></label><input type="text" class="form-control" id="kisahJudul" required></div>
                    <div class="form-group"><label>Gambar (URL)</label><input type="url" class="form-control" id="kisahGambar"></div>
                    <div class="form-group"><label>Isi <span class="required">*</span></label><textarea class="form-control" id="kisahIsi" rows="6" required></textarea></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModalKisah()">Batal</button><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal Donasi -->
    <div class="modal" id="modalDonasi">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modalDonasiTitle">Tambah Rekening</h3><button class="modal-close" onclick="closeModalDonasi()"><i class="fas fa-times"></i></button></div>
            <form onsubmit="saveDonasi(event)">
                <div class="modal-body">
                    <input type="hidden" id="donasiIndex" value="-1">
                    <div class="form-group"><label>Bank <span class="required">*</span></label><input type="text" class="form-control" id="donasiBank" required></div>
                    <div class="form-group"><label>No. Rekening <span class="required">*</span></label><input type="text" class="form-control" id="donasiNoRekening" required></div>
                    <div class="form-group"><label>Atas Nama <span class="required">*</span></label><input type="text" class="form-control" id="donasiAtasNama" required></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModalDonasi()">Batal</button><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal Galeri -->
    <div class="modal" id="modalGaleri">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modalGaleriTitle">Tambah Galeri</h3><button class="modal-close" onclick="closeModalGaleri()"><i class="fas fa-times"></i></button></div>
            <form onsubmit="saveGaleri(event)">
                <div class="modal-body">
                    <input type="hidden" id="galeriIndex" value="-1">
                    <div class="form-group"><label>Platform <span class="required">*</span></label><select class="form-control" id="galeriPlatform" required onchange="onPlatformChange()"><option value="">-- Pilih --</option><option value="foto">ðŸ“· Foto</option><option value="youtube">ðŸŽ¬ YouTube</option><option value="instagram">ðŸ“¸ Instagram</option><option value="tiktok">ðŸŽµ TikTok</option></select></div>
                    <div class="form-group" id="inputFoto" style="display:none;"><label>URL Foto</label><input type="url" class="form-control" id="galeriFotoUrl"></div>
                    <div class="form-group" id="inputYoutube" style="display:none;"><label>URL YouTube</label><input type="url" class="form-control" id="galeriYoutubeUrl"></div>
                    <div class="form-group" id="inputInstagram" style="display:none;"><label>URL Instagram</label><input type="url" class="form-control" id="galeriInstagramUrl"></div>
                    <div class="form-group" id="inputTiktok" style="display:none;"><label>URL TikTok</label><input type="url" class="form-control" id="galeriTiktokUrl"></div>
                    <div class="form-group"><label>Caption</label><input type="text" class="form-control" id="galeriCaption"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModalGaleri()">Batal</button><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Modal Pengumuman -->
    <div class="modal" id="modalPengumuman">
        <div class="modal-content">
            <div class="modal-header"><h3 id="modalPengumumanTitle">Tambah Pengumuman</h3><button class="modal-close" onclick="closeModalPengumuman()"><i class="fas fa-times"></i></button></div>
            <form onsubmit="savePengumuman(event)">
                <div class="modal-body">
                    <input type="hidden" id="pengumumanIndex" value="-1">
                    <div class="form-group"><label>Tanggal <span class="required">*</span></label><input type="date" class="form-control" id="pengumumanTanggal" required></div>
                    <div class="form-group"><label>Judul <span class="required">*</span></label><input type="text" class="form-control" id="pengumumanJudul" required></div>
                    <div class="form-group"><label>Isi <span class="required">*</span></label><textarea class="form-control" id="pengumumanIsi" rows="4" required></textarea></div>
                    <div class="form-group"><label style="display:flex;align-items:center;gap:15px;cursor:pointer;"><span>Tandai Penting</span><label class="toggle-switch"><input type="checkbox" id="pengumumanPenting"><span class="toggle-slider"></span></label></label></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" onclick="closeModalPengumuman()">Batal</button><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Simpan</button></div>
            </form>
        </div>
    </div>

    <!-- Loading & Toast -->
    <div class="loading-overlay" id="loadingOverlay"><i class="fas fa-spinner"></i><span>Menyimpan...</span></div>
    <div class="toast" id="toast"><i class="fas fa-check-circle"></i><span id="toastMessage">Berhasil!</span></div>

    <!-- JAVASCRIPT -->
    <script>
    // ============================================
    // KONFIGURASI - GANTI DENGAN DATA ANDA
    // ============================================
    const CONFIG = {
        BIN_ID: '695efa2343b1c97be920910e',
        API_KEY: '$2a$10$mu94DGoU.bNfbEUgWcjffueeAaIQfeb2hMzp.TM.Tg6M8JiaUOIVm',
        USERNAME: 'admin',
        PASSWORD: 'mekarindah2025'
    };
    const API_URL = 'https://api.jsonbin.io/v3/b/' + CONFIG.BIN_ID;
    let siteData = null;

    // LOGIN
    function handleLogin(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        if (username === CONFIG.USERNAME && password === CONFIG.PASSWORD) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminContainer').classList.add('active');
            sessionStorage.setItem('isLoggedIn', 'true');
            loadData();
        } else {
            const err = document.getElementById('loginError');
            err.style.display = 'flex';
            setTimeout(function() { err.style.display = 'none'; }, 3000);
        }
    }
    function handleLogout() { if (confirm('Logout?')) { sessionStorage.removeItem('isLoggedIn'); location.reload(); } }
    function checkLogin() {
        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminContainer').classList.add('active');
            loadData();
        }
    }

    // NAVIGATION
    function initNavigation() {
        document.querySelectorAll('.menu-item').forEach(function(item) {
            item.addEventListener('click', function() {
                document.querySelectorAll('.menu-item').forEach(function(m) { m.classList.remove('active'); });
                this.classList.add('active');
                document.querySelectorAll('.page').forEach(function(p) { p.classList.remove('active'); });
                document.getElementById('page-' + this.dataset.page).classList.add('active');
                document.getElementById('pageTitle').innerHTML = '<i class="' + this.querySelector('i').className + '"></i> ' + this.querySelector('span').textContent;
                if (window.innerWidth <= 768) toggleSidebar();
            });
        });
    }
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('active');
        document.getElementById('sidebarOverlay').classList.toggle('active');
    }

    // LOAD & SAVE
    async function loadData() {
        showLoading();
        try {
            const res = await fetch(API_URL + '/latest', { headers: { 'X-Master-Key': CONFIG.API_KEY } });
            if (!res.ok) throw new Error('Fetch failed');
            siteData = (await res.json()).record;
            initDataStructure();
            renderAll();
        } catch (e) { console.error(e); showToast('Gagal memuat data!', 'error'); initEmptyData(); }
        hideLoading();
    }
    async function saveData() {
        showLoading();
        try {
            const res = await fetch(API_URL, { method: 'PUT', headers: { 'Content-Type': 'application/json', 'X-Master-Key': CONFIG.API_KEY }, body: JSON.stringify(siteData) });
            if (!res.ok) throw new Error('Save failed');
            showToast('Berhasil disimpan!', 'success');
            return true;
        } catch (e) { console.error(e); showToast('Gagal menyimpan!', 'error'); return false; }
        finally { hideLoading(); }
    }
    function initDataStructure() {
        if (!siteData) siteData = {};
        if (!siteData.settings) siteData.settings = { namaMasjid: 'Masjid Mekarindah', alamat: '', deskripsi: '', visi: '', misi: [], fotoMasjid: '', facebook: '', instagram: '', youtube: '', whatsapp: '' };
        if (!siteData.jadwalSholat) siteData.jadwalSholat = { subuh: '04:30', dzuhur: '12:00', ashar: '15:15', maghrib: '18:00', isya: '19:15' };
        if (!siteData.pengurus) siteData.pengurus = [];
        if (!siteData.jadwalKajian) siteData.jadwalKajian = {};
        if (!siteData.keuangan) siteData.keuangan = { saldoAwal: 0, transaksi: [] };
        if (Array.isArray(siteData.keuangan)) siteData.keuangan = { saldoAwal: 0, transaksi: siteData.keuangan };
        if (!siteData.keuangan.transaksi) siteData.keuangan.transaksi = [];
        if (!siteData.zakat) siteData.zakat = { saldoAwal: 0, transaksi: [] };
        if (Array.isArray(siteData.zakat)) siteData.zakat = { saldoAwal: 0, transaksi: siteData.zakat };
        if (!siteData.zakat.transaksi) siteData.zakat.transaksi = [];
        if (!siteData.kisahInspiratif) siteData.kisahInspiratif = [];
        if (!siteData.donasi) siteData.donasi = [];
        if (!siteData.galeri) siteData.galeri = [];
        if (!siteData.pengumuman) siteData.pengumuman = [];
    }
    function initEmptyData() { siteData = {}; initDataStructure(); renderAll(); }
    function renderAll() { renderDashboard(); renderPengaturan(); renderJadwalSholat(); renderPengurus(); renderKajian(); renderKeuangan(); renderZakat(); renderKisah(); renderDonasi(); renderGaleri(); renderPengumuman(); }

    // HELPERS
    function showLoading() { document.getElementById('loadingOverlay').classList.add('active'); }
    function hideLoading() { document.getElementById('loadingOverlay').classList.remove('active'); }
    function showToast(msg, type) {
        const t = document.getElementById('toast');
        t.className = 'toast active ' + (type === 'success' ? 'success' : 'error');
        t.querySelector('i').className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
        document.getElementById('toastMessage').textContent = msg;
        setTimeout(function() { t.classList.remove('active'); }, 3000);
    }
    function formatRupiah(n) { return 'Rp ' + Number(n || 0).toLocaleString('id-ID'); }
    function formatDate(d) { if (!d) return '-'; return new Date(d).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' }); }
    function escapeHtml(t) { if (!t) return ''; const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

    // DASHBOARD
    function renderDashboard() {
        let kasAwal = Number(siteData.keuangan?.saldoAwal) || 0, kasIn = 0, kasOut = 0;
        (siteData.keuangan?.transaksi || []).forEach(t => { if (t.jenis === 'pemasukan') kasIn += Number(t.jumlah); else kasOut += Number(t.jumlah); });
        document.getElementById('statSaldoKas').textContent = formatRupiah(kasAwal + kasIn - kasOut);
        let zakAwal = Number(siteData.zakat?.saldoAwal) || 0, zakIn = 0, zakOut = 0;
        (siteData.zakat?.transaksi || []).forEach(t => { if (t.jenis === 'pemasukan') zakIn += Number(t.jumlah); else zakOut += Number(t.jumlah); });
        document.getElementById('statSaldoZakat').textContent = formatRupiah(zakAwal + zakIn - zakOut);
        document.getElementById('statPengurus').textContent = siteData.pengurus?.length || 0;
        document.getElementById('statGaleri').textContent = siteData.galeri?.length || 0;
        const c = document.getElementById('dashboardPengumuman');
        if (!siteData.pengumuman?.length) { c.innerHTML = '<p style="color:var(--gray);">Belum ada pengumuman</p>'; return; }
        const sorted = siteData.pengumuman.slice().sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal)).slice(0, 3);
        c.innerHTML = sorted.map(p => '<div style="padding:10px 0;border-bottom:1px solid #eee;"><strong>' + escapeHtml(p.judul) + '</strong>' + (p.penting ? ' <span class="badge badge-danger">Penting</span>' : '') + '<br><small style="color:var(--gray);">' + formatDate(p.tanggal) + '</small></div>').join('');
    }

    // PENGATURAN
    function renderPengaturan() {
        const s = siteData.settings || {};
        document.getElementById('setNamaMasjid').value = s.namaMasjid || '';
        document.getElementById('setFotoMasjid').value = s.fotoMasjid || '';
        document.getElementById('setAlamat').value = s.alamat || '';
        document.getElementById('setDeskripsi').value = s.deskripsi || '';
        document.getElementById('setVisi').value = s.visi || '';
        document.getElementById('setFacebook').value = s.facebook || '';
        document.getElementById('setInstagram').value = s.instagram || '';
        document.getElementById('setYoutube').value = s.youtube || '';
        document.getElementById('setWhatsapp').value = s.whatsapp || '';
        renderMisiList();
    }
    function renderMisiList() {
        let misi = siteData.settings?.misi || []; if (!misi.length) misi = [''];
        document.getElementById('misiList').innerHTML = misi.map((m, i) => '<div class="misi-item"><input type="text" class="misi-input" value="' + escapeHtml(m) + '" placeholder="Misi ' + (i + 1) + '"><button type="button" class="btn btn-danger btn-icon" onclick="removeMisiItem(' + i + ')"><i class="fas fa-trash"></i></button></div>').join('');
    }
    function addMisiItem() { if (!siteData.settings.misi) siteData.settings.misi = []; siteData.settings.misi.push(''); renderMisiList(); }
    function removeMisiItem(i) { if (siteData.settings.misi.length > 1) { siteData.settings.misi.splice(i, 1); renderMisiList(); } }
    function savePengaturan(e) {
        e.preventDefault();
        const misi = []; document.querySelectorAll('.misi-input').forEach(inp => { if (inp.value.trim()) misi.push(inp.value.trim()); });
        siteData.settings = { namaMasjid: document.getElementById('setNamaMasjid').value, fotoMasjid: document.getElementById('setFotoMasjid').value, alamat: document.getElementById('setAlamat').value, deskripsi: document.getElementById('setDeskripsi').value, visi: document.getElementById('setVisi').value, misi: misi, facebook: document.getElementById('setFacebook').value, instagram: document.getElementById('setInstagram').value, youtube: document.getElementById('setYoutube').value, whatsapp: document.getElementById('setWhatsapp').value };
        saveData();
    }

    // JADWAL SHOLAT
    function renderJadwalSholat() {
        const j = siteData.jadwalSholat || {};
        document.getElementById('jadwalSubuh').value = j.subuh || '';
        document.getElementById('jadwalDzuhur').value = j.dzuhur || '';
        document.getElementById('jadwalAshar').value = j.ashar || '';
        document.getElementById('jadwalMaghrib').value = j.maghrib || '';
        document.getElementById('jadwalIsya').value = j.isya || '';
    }
    function saveJadwalSholat(e) {
        e.preventDefault();
        siteData.jadwalSholat = { subuh: document.getElementById('jadwalSubuh').value, dzuhur: document.getElementById('jadwalDzuhur').value, ashar: document.getElementById('jadwalAshar').value, maghrib: document.getElementById('jadwalMaghrib').value, isya: document.getElementById('jadwalIsya').value };
        saveData();
    }

    // PENGURUS
    function renderPengurus() {
        const tb = document.getElementById('tbodyPengurus');
        if (!siteData.pengurus?.length) { tb.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--gray);">Belum ada</td></tr>'; return; }
        tb.innerHTML = siteData.pengurus.map((p, i) => '<tr><td data-label="Foto"><img src="' + (p.foto || 'https://via.placeholder.com/50') + '"></td><td data-label="Nama">' + escapeHtml(p.nama) + '</td><td data-label="Jabatan">' + escapeHtml(p.jabatan) + '</td><td data-label="Kategori"><span class="badge badge-primary">' + escapeHtml(p.kategori) + '</span></td><td data-label="Aksi"><div class="btn-group"><button class="btn btn-warning btn-icon" onclick="editPengurus(' + i + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-icon" onclick="deletePengurus(' + i + ')"><i class="fas fa-trash"></i></button></div></td></tr>').join('');
    }
    function openModalPengurus() { document.getElementById('modalPengurusTitle').textContent = 'Tambah Pengurus'; document.getElementById('pengurusIndex').value = '-1'; document.getElementById('pengurusNama').value = ''; document.getElementById('pengurusJabatan').value = ''; document.getElementById('pengurusKategori').value = ''; document.getElementById('pengurusFoto').value = ''; document.getElementById('modalPengurus').classList.add('active'); }
    function closeModalPengurus() { document.getElementById('modalPengurus').classList.remove('active'); }
    function editPengurus(i) { const p = siteData.pengurus[i]; document.getElementById('modalPengurusTitle').textContent = 'Edit Pengurus'; document.getElementById('pengurusIndex').value = i; document.getElementById('pengurusNama').value = p.nama || ''; document.getElementById('pengurusJabatan').value = p.jabatan || ''; document.getElementById('pengurusKategori').value = p.kategori || ''; document.getElementById('pengurusFoto').value = p.foto || ''; document.getElementById('modalPengurus').classList.add('active'); }
    function savePengurus(e) { e.preventDefault(); const i = parseInt(document.getElementById('pengurusIndex').value); const d = { nama: document.getElementById('pengurusNama').value, jabatan: document.getElementById('pengurusJabatan').value, kategori: document.getElementById('pengurusKategori').value, foto: document.getElementById('pengurusFoto').value }; if (i === -1) siteData.pengurus.push(d); else siteData.pengurus[i] = d; closeModalPengurus(); saveData().then(() => { renderPengurus(); renderDashboard(); }); }
    function deletePengurus(i) { if (confirm('Hapus?')) { siteData.pengurus.splice(i, 1); saveData().then(() => { renderPengurus(); renderDashboard(); }); } }

    // KAJIAN
    function renderKajian() {
        const hari = ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu', 'ahad'];
        const label = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Ahad'];
        document.getElementById('kajianEditGrid').innerHTML = hari.map((h, idx) => { const k = siteData.jadwalKajian?.[h] || {}; return '<div class="kajian-day-card"><div class="kajian-day-header"><i class="fas fa-calendar-day"></i> ' + label[idx] + '</div><div class="kajian-day-body"><div class="form-group"><label>Nama</label><input class="form-control" id="kajian_' + h + '_nama" value="' + escapeHtml(k.nama || '') + '"></div><div class="form-group"><label>Waktu</label><input class="form-control" id="kajian_' + h + '_waktu" value="' + escapeHtml(k.waktu || '') + '"></div><div class="form-group"><label>Pemateri</label><input class="form-control" id="kajian_' + h + '_pemateri" value="' + escapeHtml(k.pemateri || '') + '"></div><div class="form-group"><label>Link Video</label><input class="form-control" id="kajian_' + h + '_linkVideo" value="' + escapeHtml(k.linkVideo || '') + '"></div><div class="form-group"><label>Link Audio</label><input class="form-control" id="kajian_' + h + '_linkAudio" value="' + escapeHtml(k.linkAudio || '') + '"></div></div></div>'; }).join('');
    }
    function saveKajian(e) { e.preventDefault(); siteData.jadwalKajian = {}; ['senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu', 'ahad'].forEach(h => { siteData.jadwalKajian[h] = { nama: document.getElementById('kajian_' + h + '_nama').value, waktu: document.getElementById('kajian_' + h + '_waktu').value, pemateri: document.getElementById('kajian_' + h + '_pemateri').value, linkVideo: document.getElementById('kajian_' + h + '_linkVideo').value, linkAudio: document.getElementById('kajian_' + h + '_linkAudio').value }; }); saveData(); }

    // KEUANGAN
    function renderKeuangan() {
        document.getElementById('keuanganSaldoAwal').value = siteData.keuangan?.saldoAwal || 0;
        let awal = Number(siteData.keuangan?.saldoAwal) || 0, masuk = 0, keluar = 0;
        (siteData.keuangan?.transaksi || []).forEach(t => { if (t.jenis === 'pemasukan') masuk += Number(t.jumlah); else keluar += Number(t.jumlah); });
        document.getElementById('keuanganPemasukan').textContent = formatRupiah(masuk);
        document.getElementById('keuanganPengeluaran').textContent = formatRupiah(keluar);
        document.getElementById('keuanganSaldo').textContent = formatRupiah(awal + masuk - keluar);
        const tb = document.getElementById('tbodyKeuangan'), tr = siteData.keuangan?.transaksi || [];
        if (!tr.length) { tb.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--gray);">Belum ada</td></tr>'; return; }
        const sorted = tr.slice().sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
        tb.innerHTML = sorted.map(t => { const i = tr.indexOf(t); return '<tr><td data-label="Tanggal">' + formatDate(t.tanggal) + '</td><td data-label="Keterangan">' + escapeHtml(t.keterangan) + '</td><td data-label="Jenis"><span class="badge ' + (t.jenis === 'pemasukan' ? 'badge-success">Masuk' : 'badge-danger">Keluar') + '</span></td><td data-label="Jumlah">' + (t.jenis === 'pemasukan' ? '+' : '-') + ' ' + formatRupiah(t.jumlah) + '</td><td data-label="Aksi"><div class="btn-group"><button class="btn btn-warning btn-icon" onclick="editKeuangan(' + i + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-icon" onclick="deleteKeuangan(' + i + ')"><i class="fas fa-trash"></i></button></div></td></tr>'; }).join('');
    }
    function updateSaldoAwalKeuangan() { siteData.keuangan.saldoAwal = Number(document.getElementById('keuanganSaldoAwal').value); saveData().then(() => { renderKeuangan(); renderDashboard(); }); }
    function openModalKeuangan() { document.getElementById('modalKeuanganTitle').textContent = 'Tambah Transaksi'; document.getElementById('keuanganIndex').value = '-1'; document.getElementById('keuanganTanggal').value = new Date().toISOString().split('T')[0]; document.getElementById('keuanganJenis').value = ''; document.getElementById('keuanganJumlah').value = ''; document.getElementById('keuanganKeterangan').value = ''; document.getElementById('modalKeuangan').classList.add('active'); }
    function closeModalKeuangan() { document.getElementById('modalKeuangan').classList.remove('active'); }
    function editKeuangan(i) { const t = siteData.keuangan.transaksi[i]; document.getElementById('modalKeuanganTitle').textContent = 'Edit'; document.getElementById('keuanganIndex').value = i; document.getElementById('keuanganTanggal').value = t.tanggal || ''; document.getElementById('keuanganJenis').value = t.jenis || ''; document.getElementById('keuanganJumlah').value = t.jumlah || ''; document.getElementById('keuanganKeterangan').value = t.keterangan || ''; document.getElementById('modalKeuangan').classList.add('active'); }
    function saveKeuangan(e) { e.preventDefault(); const i = parseInt(document.getElementById('keuanganIndex').value); const d = { tanggal: document.getElementById('keuanganTanggal').value, jenis: document.getElementById('keuanganJenis').value, jumlah: Number(document.getElementById('keuanganJumlah').value), keterangan: document.getElementById('keuanganKeterangan').value }; if (!siteData.keuangan.transaksi) siteData.keuangan.transaksi = []; if (i === -1) siteData.keuangan.transaksi.push(d); else siteData.keuangan.transaksi[i] = d; closeModalKeuangan(); saveData().then(() => { renderKeuangan(); renderDashboard(); }); }
    function deleteKeuangan(i) { if (confirm('Hapus?')) { siteData.keuangan.transaksi.splice(i, 1); saveData().then(() => { renderKeuangan(); renderDashboard(); }); } }

    // ZAKAT
    function renderZakat() {
        document.getElementById('zakatSaldoAwal').value = siteData.zakat?.saldoAwal || 0;
        let awal = Number(siteData.zakat?.saldoAwal) || 0, masuk = 0, keluar = 0;
        (siteData.zakat?.transaksi || []).forEach(t => { if (t.jenis === 'pemasukan') masuk += Number(t.jumlah); else keluar += Number(t.jumlah); });
        document.getElementById('zakatPemasukan').textContent = formatRupiah(masuk);
        document.getElementById('zakatPengeluaran').textContent = formatRupiah(keluar);
        document.getElementById('zakatSaldo').textContent = formatRupiah(awal + masuk - keluar);
        const tb = document.getElementById('tbodyZakat'), tr = siteData.zakat?.transaksi || [];
        if (!tr.length) { tb.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--gray);">Belum ada</td></tr>'; return; }
        const sorted = tr.slice().sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
        tb.innerHTML = sorted.map(t => { const i = tr.indexOf(t); return '<tr><td data-label="Tanggal">' + formatDate(t.tanggal) + '</td><td data-label="Keterangan">' + escapeHtml(t.keterangan) + '</td><td data-label="Jenis"><span class="badge ' + (t.jenis === 'pemasukan' ? 'badge-success">Masuk' : 'badge-danger">Salur') + '</span></td><td data-label="Jumlah">' + (t.jenis === 'pemasukan' ? '+' : '-') + ' ' + formatRupiah(t.jumlah) + '</td><td data-label="Aksi"><div class="btn-group"><button class="btn btn-warning btn-icon" onclick="editZakat(' + i + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-icon" onclick="deleteZakat(' + i + ')"><i class="fas fa-trash"></i></button></div></td></tr>'; }).join('');
    }
    function updateSaldoAwalZakat() { siteData.zakat.saldoAwal = Number(document.getElementById('zakatSaldoAwal').value); saveData().then(() => { renderZakat(); renderDashboard(); }); }
    function openModalZakat() { document.getElementById('modalZakatTitle').textContent = 'Tambah Transaksi'; document.getElementById('zakatIndex').value = '-1'; document.getElementById('zakatTanggal').value = new Date().toISOString().split('T')[0]; document.getElementById('zakatJenis').value = ''; document.getElementById('zakatJumlah').value = ''; document.getElementById('zakatKeterangan').value = ''; document.getElementById('modalZakat').classList.add('active'); }
    function closeModalZakat() { document.getElementById('modalZakat').classList.remove('active'); }
    function editZakat(i) { const t = siteData.zakat.transaksi[i]; document.getElementById('modalZakatTitle').textContent = 'Edit'; document.getElementById('zakatIndex').value = i; document.getElementById('zakatTanggal').value = t.tanggal || ''; document.getElementById('zakatJenis').value = t.jenis || ''; document.getElementById('zakatJumlah').value = t.jumlah || ''; document.getElementById('zakatKeterangan').value = t.keterangan || ''; document.getElementById('modalZakat').classList.add('active'); }
    function saveZakat(e) { e.preventDefault(); const i = parseInt(document.getElementById('zakatIndex').value); const d = { tanggal: document.getElementById('zakatTanggal').value, jenis: document.getElementById('zakatJenis').value, jumlah: Number(document.getElementById('zakatJumlah').value), keterangan: document.getElementById('zakatKeterangan').value }; if (!siteData.zakat.transaksi) siteData.zakat.transaksi = []; if (i === -1) siteData.zakat.transaksi.push(d); else siteData.zakat.transaksi[i] = d; closeModalZakat(); saveData().then(() => { renderZakat(); renderDashboard(); }); }
    function deleteZakat(i) { if (confirm('Hapus?')) { siteData.zakat.transaksi.splice(i, 1); saveData().then(() => { renderZakat(); renderDashboard(); }); } }

    // KISAH
    function renderKisah() {
        const tb = document.getElementById('tbodyKisah');
        if (!siteData.kisahInspiratif?.length) { tb.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--gray);">Belum ada</td></tr>'; return; }
        tb.innerHTML = siteData.kisahInspiratif.map((k, i) => '<tr><td data-label="Gambar"><img src="' + (k.gambar || 'https://via.placeholder.com/80x60') + '" style="width:80px;height:60px;border-radius:8px;object-fit:cover;"></td><td data-label="Judul"><strong>' + escapeHtml(k.judul) + '</strong></td><td data-label="Isi">' + escapeHtml((k.isi || '').substring(0, 60)) + '...</td><td data-label="Aksi"><div class="btn-group"><button class="btn btn-warning btn-icon" onclick="editKisah(' + i + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-icon" onclick="deleteKisah(' + i + ')"><i class="fas fa-trash"></i></button></div></td></tr>').join('');
    }
    function openModalKisah() { document.getElementById('modalKisahTitle').textContent = 'Tambah Kisah'; document.getElementById('kisahIndex').value = '-1'; document.getElementById('kisahJudul').value = ''; document.getElementById('kisahGambar').value = ''; document.getElementById('kisahIsi').value = ''; document.getElementById('modalKisah').classList.add('active'); }
    function closeModalKisah() { document.getElementById('modalKisah').classList.remove('active'); }
    function editKisah(i) { const k = siteData.kisahInspiratif[i]; document.getElementById('modalKisahTitle').textContent = 'Edit Kisah'; document.getElementById('kisahIndex').value = i; document.getElementById('kisahJudul').value = k.judul || ''; document.getElementById('kisahGambar').value = k.gambar || ''; document.getElementById('kisahIsi').value = k.isi || ''; document.getElementById('modalKisah').classList.add('active'); }
    function saveKisah(e) { e.preventDefault(); const i = parseInt(document.getElementById('kisahIndex').value); const d = { judul: document.getElementById('kisahJudul').value, gambar: document.getElementById('kisahGambar').value, isi: document.getElementById('kisahIsi').value }; if (!siteData.kisahInspiratif) siteData.kisahInspiratif = []; if (i === -1) siteData.kisahInspiratif.push(d); else siteData.kisahInspiratif[i] = d; closeModalKisah(); saveData().then(() => renderKisah()); }
    function deleteKisah(i) { if (confirm('Hapus?')) { siteData.kisahInspiratif.splice(i, 1); saveData().then(() => renderKisah()); } }

    // DONASI
    function renderDonasi() {
        const tb = document.getElementById('tbodyDonasi');
        if (!siteData.donasi?.length) { tb.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--gray);">Belum ada</td></tr>'; return; }
        tb.innerHTML = siteData.donasi.map((d, i) => '<tr><td data-label="Bank"><strong>' + escapeHtml(d.bank) + '</strong></td><td data-label="No. Rekening"><code style="background:#f5f5f5;padding:5px 10px;border-radius:5px;">' + escapeHtml(d.noRekening) + '</code></td><td data-label="Atas Nama">' + escapeHtml(d.atasNama) + '</td><td data-label="Aksi"><div class="btn-group"><button class="btn btn-warning btn-icon" onclick="editDonasi(' + i + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-icon" onclick="deleteDonasi(' + i + ')"><i class="fas fa-trash"></i></button></div></td></tr>').join('');
    }
    function openModalDonasi() { document.getElementById('modalDonasiTitle').textContent = 'Tambah Rekening'; document.getElementById('donasiIndex').value = '-1'; document.getElementById('donasiBank').value = ''; document.getElementById('donasiNoRekening').value = ''; document.getElementById('donasiAtasNama').value = ''; document.getElementById('modalDonasi').classList.add('active'); }
    function closeModalDonasi() { document.getElementById('modalDonasi').classList.remove('active'); }
    function editDonasi(i) { const d = siteData.donasi[i]; document.getElementById('modalDonasiTitle').textContent = 'Edit Rekening'; document.getElementById('donasiIndex').value = i; document.getElementById('donasiBank').value = d.bank || ''; document.getElementById('donasiNoRekening').value = d.noRekening || ''; document.getElementById('donasiAtasNama').value = d.atasNama || ''; document.getElementById('modalDonasi').classList.add('active'); }
    function saveDonasi(e) { e.preventDefault(); const i = parseInt(document.getElementById('donasiIndex').value); const d = { bank: document.getElementById('donasiBank').value, noRekening: document.getElementById('donasiNoRekening').value, atasNama: document.getElementById('donasiAtasNama').value }; if (!siteData.donasi) siteData.donasi = []; if (i === -1) siteData.donasi.push(d); else siteData.donasi[i] = d; closeModalDonasi(); saveData().then(() => renderDonasi()); }
    function deleteDonasi(i) { if (confirm('Hapus?')) { siteData.donasi.splice(i, 1); saveData().then(() => renderDonasi()); } }

    // GALERI
    function renderGaleri() {
        const tb = document.getElementById('tbodyGaleri');
        if (!siteData.galeri?.length) { tb.innerHTML = '<tr><td colspan="4" style="text-align:center;color:var(--gray);">Belum ada</td></tr>'; return; }
        tb.innerHTML = siteData.galeri.map((g, i) => { let pv = '', pl = ''; if (g.tipe === 'foto') { pv = '<div class="galeri-preview"><img src="' + g.url + '"></div>'; pl = '<span class="platform-highlight foto"><i class="fas fa-image"></i> Foto</span>'; } else if (g.tipe === 'youtube') { pv = '<div class="galeri-preview youtube"><i class="fab fa-youtube"></i></div>'; pl = '<span class="platform-highlight youtube"><i class="fab fa-youtube"></i> YouTube</span>'; } else if (g.tipe === 'instagram') { pv = '<div class="galeri-preview instagram"><i class="fab fa-instagram"></i></div>'; pl = '<span class="platform-highlight instagram"><i class="fab fa-instagram"></i> Instagram</span>'; } else if (g.tipe === 'tiktok') { pv = '<div class="galeri-preview tiktok"><i class="fab fa-tiktok"></i></div>'; pl = '<span class="platform-highlight tiktok"><i class="fab fa-tiktok"></i> TikTok</span>'; } return '<tr><td data-label="Preview">' + pv + '</td><td data-label="Platform">' + pl + '</td><td data-label="Caption">' + escapeHtml(g.caption || '-') + '</td><td data-label="Aksi"><div class="btn-group"><button class="btn btn-warning btn-icon" onclick="editGaleri(' + i + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-icon" onclick="deleteGaleri(' + i + ')"><i class="fas fa-trash"></i></button></div></td></tr>'; }).join('');
    }
    function onPlatformChange() { const p = document.getElementById('galeriPlatform').value; document.getElementById('inputFoto').style.display = p === 'foto' ? 'block' : 'none'; document.getElementById('inputYoutube').style.display = p === 'youtube' ? 'block' : 'none'; document.getElementById('inputInstagram').style.display = p === 'instagram' ? 'block' : 'none'; document.getElementById('inputTiktok').style.display = p === 'tiktok' ? 'block' : 'none'; }
    function openModalGaleri() { document.getElementById('modalGaleriTitle').textContent = 'Tambah Galeri'; document.getElementById('galeriIndex').value = '-1'; document.getElementById('galeriPlatform').value = ''; document.getElementById('galeriFotoUrl').value = ''; document.getElementById('galeriYoutubeUrl').value = ''; document.getElementById('galeriInstagramUrl').value = ''; document.getElementById('galeriTiktokUrl').value = ''; document.getElementById('galeriCaption').value = ''; document.getElementById('inputFoto').style.display = 'none'; document.getElementById('inputYoutube').style.display = 'none'; document.getElementById('inputInstagram').style.display = 'none'; document.getElementById('inputTiktok').style.display = 'none'; document.getElementById('modalGaleri').classList.add('active'); }
    function closeModalGaleri() { document.getElementById('modalGaleri').classList.remove('active'); }
    function editGaleri(i) { const g = siteData.galeri[i]; document.getElementById('modalGaleriTitle').textContent = 'Edit Galeri'; document.getElementById('galeriIndex').value = i; document.getElementById('galeriPlatform').value = g.tipe || ''; document.getElementById('galeriCaption').value = g.caption || ''; document.getElementById('galeriFotoUrl').value = ''; document.getElementById('galeriYoutubeUrl').value = ''; document.getElementById('galeriInstagramUrl').value = ''; document.getElementById('galeriTiktokUrl').value = ''; document.getElementById('inputFoto').style.display = 'none'; document.getElementById('inputYoutube').style.display = 'none'; document.getElementById('inputInstagram').style.display = 'none'; document.getElementById('inputTiktok').style.display = 'none'; if (g.tipe === 'foto') { document.getElementById('inputFoto').style.display = 'block'; document.getElementById('galeriFotoUrl').value = g.url || ''; } else if (g.tipe === 'youtube') { document.getElementById('inputYoutube').style.display = 'block'; document.getElementById('galeriYoutubeUrl').value = g.youtubeId ? 'https://youtube.com/watch?v=' + g.youtubeId : ''; } else if (g.tipe === 'instagram') { document.getElementById('inputInstagram').style.display = 'block'; document.getElementById('galeriInstagramUrl').value = g.instagramUrl || ''; } else if (g.tipe === 'tiktok') { document.getElementById('inputTiktok').style.display = 'block'; document.getElementById('galeriTiktokUrl').value = g.tiktokUrl || ''; } document.getElementById('modalGaleri').classList.add('active'); }
    function extractYoutubeId(u) { if (!u) return null; let m = u.match(/[?&]v=([^&]+)/); if (m) return m[1]; m = u.match(/youtu\.be\/([^?&]+)/); if (m) return m[1]; m = u.match(/youtube\.com\/embed\/([^?&]+)/); if (m) return m[1]; m = u.match(/youtube\.com\/shorts\/([^?&]+)/); if (m) return m[1]; m = u.match(/youtube\.com\/live\/([^?&]+)/); if (m) return m[1]; return null; }
    function extractInstagramId(u) { if (!u) return null; let m = u.match(/instagram\.com\/p\/([^/?]+)/); if (m) return m[1]; m = u.match(/instagram\.com\/reel\/([^/?]+)/); if (m) return m[1]; m = u.match(/instagram\.com\/reels\/([^/?]+)/); if (m) return m[1]; return null; }
    function extractTiktokId(u) { if (!u) return null; let m = u.match(/tiktok\.com\/@[^/]+\/video\/(\d+)/); if (m) return m[1]; if (u.includes('vm.tiktok.com') || u.includes('tiktok.com/t/')) return 'short'; return null; }
    function saveGaleri(e) { e.preventDefault(); const i = parseInt(document.getElementById('galeriIndex').value); const p = document.getElementById('galeriPlatform').value; if (!p) { alert('Pilih platform!'); return; } let d = { tipe: p, caption: document.getElementById('galeriCaption').value }; if (p === 'foto') { const u = document.getElementById('galeriFotoUrl').value; if (!u) { alert('Isi URL foto!'); return; } d.url = u; } else if (p === 'youtube') { const u = document.getElementById('galeriYoutubeUrl').value; const id = extractYoutubeId(u); if (!id) { alert('URL YouTube tidak valid!'); return; } d.youtubeId = id; } else if (p === 'instagram') { const u = document.getElementById('galeriInstagramUrl').value; const id = extractInstagramId(u); if (!id) { alert('URL Instagram tidak valid!'); return; } d.instagramId = id; d.instagramUrl = u; } else if (p === 'tiktok') { const u = document.getElementById('galeriTiktokUrl').value; const id = extractTiktokId(u); if (!id) { alert('URL TikTok tidak valid!'); return; } d.tiktokId = id; d.tiktokUrl = u; } if (!siteData.galeri) siteData.galeri = []; if (i === -1) siteData.galeri.push(d); else siteData.galeri[i] = d; closeModalGaleri(); saveData().then(() => { renderGaleri(); renderDashboard(); }); }
    function deleteGaleri(i) { if (confirm('Hapus?')) { siteData.galeri.splice(i, 1); saveData().then(() => { renderGaleri(); renderDashboard(); }); } }

    // PENGUMUMAN
    function renderPengumuman() {
        const tb = document.getElementById('tbodyPengumuman');
        if (!siteData.pengumuman?.length) { tb.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--gray);">Belum ada</td></tr>'; return; }
        const sorted = siteData.pengumuman.slice().sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
        tb.innerHTML = sorted.map(p => { const i = siteData.pengumuman.indexOf(p); return '<tr><td data-label="Tanggal">' + formatDate(p.tanggal) + '</td><td data-label="Judul"><strong>' + escapeHtml(p.judul) + '</strong></td><td data-label="Isi">' + escapeHtml((p.isi || '').substring(0, 50)) + '...</td><td data-label="Status">' + (p.penting ? '<span class="badge badge-danger">Penting</span>' : '<span class="badge badge-success">Normal</span>') + '</td><td data-label="Aksi"><div class="btn-group"><button class="btn btn-warning btn-icon" onclick="editPengumuman(' + i + ')"><i class="fas fa-edit"></i></button><button class="btn btn-danger btn-icon" onclick="deletePengumuman(' + i + ')"><i class="fas fa-trash"></i></button></div></td></tr>'; }).join('');
    }
    function openModalPengumuman() { document.getElementById('modalPengumumanTitle').textContent = 'Tambah Pengumuman'; document.getElementById('pengumumanIndex').value = '-1'; document.getElementById('pengumumanTanggal').value = new Date().toISOString().split('T')[0]; document.getElementById('pengumumanJudul').value = ''; document.getElementById('pengumumanIsi').value = ''; document.getElementById('pengumumanPenting').checked = false; document.getElementById('modalPengumuman').classList.add('active'); }
    function closeModalPengumuman() { document.getElementById('modalPengumuman').classList.remove('active'); }
    function editPengumuman(i) { const p = siteData.pengumuman[i]; document.getElementById('modalPengumumanTitle').textContent = 'Edit Pengumuman'; document.getElementById('pengumumanIndex').value = i; document.getElementById('pengumumanTanggal').value = p.tanggal || ''; document.getElementById('pengumumanJudul').value = p.judul || ''; document.getElementById('pengumumanIsi').value = p.isi || ''; document.getElementById('pengumumanPenting').checked = !!p.penting; document.getElementById('modalPengumuman').classList.add('active'); }
    function savePengumuman(e) { e.preventDefault(); const i = parseInt(document.getElementById('pengumumanIndex').value); const d = { tanggal: document.getElementById('pengumumanTanggal').value, judul: document.getElementById('pengumumanJudul').value, isi: document.getElementById('pengumumanIsi').value, penting: document.getElementById('pengumumanPenting').checked }; if (!siteData.pengumuman) siteData.pengumuman = []; if (i === -1) siteData.pengumuman.push(d); else siteData.pengumuman[i] = d; closeModalPengumuman(); saveData().then(() => { renderPengumuman(); renderDashboard(); }); }
    function deletePengumuman(i) { if (confirm('Hapus?')) { siteData.pengumuman.splice(i, 1); saveData().then(() => { renderPengumuman(); renderDashboard(); }); } }

    // EVENT LISTENERS
    document.addEventListener('click', e => { if (e.target.classList.contains('modal')) e.target.classList.remove('active'); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') document.querySelectorAll('.modal.active').forEach(m => m.classList.remove('active')); });

    // INIT
    document.addEventListener('DOMContentLoaded', () => { checkLogin(); initNavigation(); });
    </script>
</body>
</html>